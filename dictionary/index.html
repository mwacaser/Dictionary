<!doctype HTML>
@@BASE
<html>
    <head>
        <title>
            Dictionary Home
        </title>
    </head>
    @@HEADER
    <script>
        function queryTerm() {
            var term = document.getElementById("term");
            var url = url = 'http://michael.wacaser.org/dictionary/word/' + term.value;
            window.fetch(url).then(res => res.json()).then(data => {
                console.log(data);
                var table = document.getElementById("results");
                table.textContent = '';
                for(var entry of data){
                    var row = document.createElement("tr");

                    var key = document.createElement("td");
                    key.append(entry.Display);
                    row.appendChild(key);

                    var value = document.createElement("td");
                    value.append(entry.Description);
                    row.appendChild(value);

                    var list = document.createElement("td");
                    list.append(entry.IDList);
                    row.appendChild(list);

                    var ebtn = document.createElement("td");
                    ebtn.innerHTML = '<button onclick="editWord(\'' + entry.IDList + '\', \'' + entry.Description + '\')">Edit</button>';
                    row.appendChild(ebtn);

                    var dbtn = document.createElement("td");
                    dbtn.innerHTML = '<button onclick="delWord(\'' + entry.ID + '\')">Del</button>';
                    row.appendChild(dbtn);

                    table.appendChild(row);
                }
            });
        }
        function addWord() {
            var idlist = document.getElementById("idlist");
            var desc = document.getElementById("desc");
            var url = url = 'http://michael.wacaser.org/dictionary/word/' + idlist.value;
            var data = { "desc": desc.value };
            console.log(data);
            window.fetch(url, { method: "POST", headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) }).then(res => res.json()).then(result => {
                console.log(result);
                queryTerm();
                idlist.value = '';
                desc.value = '';
                idlist.focus();
            });
        }
        function editWord(editList, editDesc) {
            var idlist = document.getElementById("idlist");
            var desc = document.getElementById("desc");
            idlist.value = editList;
            desc.value = editDesc;
            desc.focus();
        }
        function delWord(delID){
            if(!confirm("You are about to delete a word! Press OK to continue.")){
                return;
            }
            var url = url = 'http://michael.wacaser.org/dictionary/word/' + delID;
            window.fetch(url, { method: "DELETE" }).then(res => res.json()).then(data => {
                console.log(data);
                queryTerm();
            });
        }
    </script>
    <body>
        <div class="main">
            <div class="left">
                <div class="search">
                    Keyword search: 
                    <input type="text" id="term" />
                    <button onclick="queryTerm()" id="search">Search</button>
                </div>
                <br />
                <div class="add">
                    Add/Edit Keyword:<br/>
                    IDList: <input type="text" id="idlist" /><br/>
                    Description: <input type="text" id="desc" />
                    <button onclick="addWord()" id="add">Add</button>
                </div>
            </div>
            <div class="results">
                <table>
                    <thead>
                        <th>Key</th>
                        <th>IDList</th>
                        <th>Description</th>
                        <th></th>
                        <th></th>
                    </thead>
                    <tbody id="results">
                        <tr>
                            <td>
                                Display
                            </td>
                            <td>
                                IDList
                            </td>
                            <td>
                                Description
                            </td>
                            <td>
                                Edit
                            </td>
                            <td>
                                Del
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </body>
    <script>
        var submit = document.getElementById("term");
        submit.addEventListener("keyup", event => {
            // Number 13 is the "Enter" key on the keyboard
            if (event.keyCode === 13) {
                event.preventDefault();
                document.getElementById("search").click();
            }
        });
        var idlist = document.getElementById("idlist");
        idlist.addEventListener("keyup", event => {
            // Number 13 is the "Enter" key on the keyboard
            if (event.keyCode === 13) {
                event.preventDefault();
                document.getElementById("add").click();
            }
        });
        var desc = document.getElementById("desc");
        desc.addEventListener("keyup", event => {
            // Number 13 is the "Enter" key on the keyboard
            if (event.keyCode === 13) {
                event.preventDefault();
                document.getElementById("add").click();
            }
        });
    </script>
</html>